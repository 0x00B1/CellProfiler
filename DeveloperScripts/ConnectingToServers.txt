Setting up new computers to access WIBR servers using NFS
Susan Ma & Anne Carpenter  September 23, 2005

[[[Note: connecting via cifs://gobo is flexible because it allows you to log in from any WIBR computer using your CCDOM account, but the connection is very slow.  Connecting via nfs must be set up as follows for each computer itself, but once the connection is made it is very fast and doesn't require login]]].

If this is the first time that a computer has been set up, email unix@wi.mit.edu and ask them to give the computer permission to access each server. 

----------------------------------------------------------------
Step 1. Create new user account and add new user to WIBR sabatini groups
----------------------------------------------------------------
Create new user account (if not already done):
Use System Preferences > Accounts on the computer to add a new user (+ button). It's best to use the same shortname as you plan to use for your other unix accounts.
-----------------------------------
On Mac OSX, go to Applications > Utilities > NetInfo Manager

Security > Authenticate

Go to /  groups  	(highlight it)
And select one of the groups

Then click Duplicate (be sure you don't have one of its properties highlighted or you will duplicate one line within the group)

In the lower panel, change the fields as follows (doubleclick to edit each field):
users		root, cellprofileruser
realname 	Imaging group  [or any nice name you want to give it, doesn't matter]
name		imaging
passwd	*
gid		1110

Domain > Save changes

----------
Here are the groups:
imaging 1110
sabata 2148
sabdbw 2145
sabcarp 2153
sabatini 128
cellomics 2149
-----------
Be sure to shut down the computer to refresh the memory and make all these local settings really happen.

----------------------------------------------------------------------
Step 2. Set up nfs/WIBR network share drivers on local computer
-----------------------------------------------------------------------

Create a folder on your computer's hard drive ( at root / ) at the topmost level called 'nfs', with one subfolder for each server. You can do this at the command line in Terminal like this:
cd /
mkdir nfs
cd nfs
mkdir sabatini_dbw02
mkdir sabatini_dbw01
mkdir sabatini1_ata
mkdir sabatini2_ata
mkdir imaging
mkdir carpente_ata

Then use a text editor to create a mounting script called ConnectServers.command:

#!/bin/sh
sudo su << EOF
mount tap5:/sabatini_dbw01 /nfs/sabatini_dbw01
mount tap6:/sabatini_dbw02 /nfs/sabatini_dbw02
mount tap4:/sabatini1_ata /nfs/sabatini1_ata
mount tap4:/sabatini2_ata /nfs/sabatini2_ata
mount tap2:/imaging /nfs/imaging
mount tap6:/carpente_ata /nfs/carpente_ata
EOF

Save the above text as ConnectServers.command in your root (/) directory, and be sure to save it in Text only format (if you use Text Editor it will save it in rich text format which will not work).  Actually, the best editor to use is a command line editor or the Editor in Matlab, if you know how to use them. Or, just get a copy of the script from another computer.

Check that you have permission to execute this file in the Terminal:
cd /
ls -la   (this will list all the files and if you don't have permission it will look something like this, where there are no x's in the first block of text): 
-rw-r--r--   1 carpente  admin 581 23 Sep 12:11 ConnectServers.command
To give yourself permission, type this:
chmod a+x ConnectServers.command
So now when you type ls -la, you should get this:
-rwxr-xr-x   1 carpente  admin 581 23 Sep 12:11 ConnectServers.command

So now everything is set up, and you should never need to repeat any of the above steps for this computer.

----------------------------------------------------------------------
Step 3. Run the script to actually connect to the servers
-----------------------------------------------------------------------
This step will need to be done to remount the nfs/share folders after you restart/shutdown, but it is not necessary to repeat after logging out/in.

There are two ways to run the ConnectServers.command script:
option 1: In GUI --locate the file, right click on the file, select open with terminal. You will be prompted to enter password.  Simply doubleclicking may also work, if you have already set this type of file to open in terminal (by right clicking > Get Info, and change Open With to Terminal). You could then put a shortcut to this file in your dock (the right hand side, near the trash) if you want, by dragging the file onto the dock. Then you would just click once on the icon in the dock and the script would run.

option 2:  open terminal, be sure that you are logged in as someone who has permission to access those servers (e.g. cellprofileruser). At the command line  cd / to your root, type ./ConnectServers.command and it will prompt you for your password.

The connections are now made but are likely not visible at /nfs/FOLDERNAME, so you can either wait for a while or you can force the finder window to refresh by creating a file in the /nfs folder and then deleting it (this is a bug in Mac OS X that doesn't refresh frequently and also doesn't let you force windows to refresh).  If you can't put a new folder there, in Terminal give yourself permission to do so:     chmod a+w /nfs

Once everything refreshes, the icons for the servers will appear on the desktop (if you have Finder Preferences set to show network connections on the desktop) but also at /nfs/FOLDERNAME.