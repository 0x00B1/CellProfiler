<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Developer's Guide :: CellProfiler :: cellprofiler.org</title>
</head>

<body>
<div id="mainContent">
<h1>WARNING: DO NOT EDIT. MAKE ALL CHANGES ON THE WIKI <a href="http://dev.broadinstitute.org/imaging/privatewiki/index.php/CellProfiler_Developer%27s_Guide">PAGE</a></h1>
<h1>Developer's Guide</h1>
<ul>
  <li><a href="#intro">Introduction</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#python">Python Code</a></li>
	<ul>
		<li><a href="#python-style_guide">Style Guide</a></li>
        <ul>
        	<li><a href="#python-style_guide-module_help">Module Help</a></li>
            <li><a href="#python-style_guide-settings_help">Settings Help</a></li>
        </ul>
	  <li><a href="#python-module_simplification">Module Simplification</a></li>
      <li><a href="#python-storing_retrieving_data">Storing and Retrieving Data</a></li>
      <ul>
        	<li><a href="#python-cpimage"><em>cpimage</em></a></li>
            <li><a href="#python-cpmodule"><em>cpmodule</em></a></li>
            <li><a href="#python-settings"><em>settings</em></a></li>
            <li><a href="#python-preferences"><em>preferences</em></a></li>
            <li><a href="#python-pipeline"><em>pipeline</em></a></li>
        <li><a href="#python-workspace"><em>workspace</em></a></li>
            <li><a href="#python-measurements"><em>measurements</em></a></li>
      </ul>
      <li><a href="#python-error_handling">Error Handling</a></li>
      <li><a href="#python-displaying_results">Displaying Results</a></li>
      <li><a href="#python-debugging_hints">Debugging Hints</a></li>
	</ul>
    <li><a href="#python-running_cp_headless">Running CellProfiler Without the Graphical User Interface</a></li>
</ul>

<h1><a name="intro"></a>Introduction</h1>

<p>This document describes the code standards for CellProfiler, and gives tips
   for CellProfiler developers.</p>

<h1><a name="#python"></a>Installation</h1>
<p><em>For PC</em><br />
Install the following packages:
<ul>
<li><a href="http://www.python.org/download/releases/2.5.4/">Python 2.5.4</a>, the final version of Python 2.5</li>
<li><a href="http://cython.org/#download">Cython</a><br />
After installing Cython, create a configuration file for distutils (distutils.cfg) in your Python installation directory under the /Lib/distutils/ folder which contains the following:<br />
<pre>[build]
compiler=mingw32</pre>
</li>
<li><a href="http://sourceforge.net/project/showfiles.php?group_id=22307">MySQLDB</a></li>
<li><a href="http://www.wxpython.org/">WxPython</a></li>
<li><a href="http://sourceforge.net/projects/numpy/files/NumPy/">NumPy</a></li>
<li><a href="http://sourceforge.net/projects/scipy/files/">SciPy</a></li>
<li><a href="http://sourceforge.net/projects/matplotlib/files/matplotlib/matplotlib-0.99.1/">MatplotLib</a></li>
<li><a href="http://www.pythonware.com/products/pil/">PIL</a></li>
</ul>
Most of these have .exe installers for Windows, but you may need to look around a bit. After installation, </p> double-clicking <em>CellProfiler.py</em> will start the GUI.
<p><em>For Mac</em></p>

<h1><a name="#python"></a>Python Code</h1>

<h2><a name="python-style_guide"></a>Style Guide</h2>

<h3><a name="python-style_guide-module_help"></a>Module Help</h3>
<p>The Module Help window (which also constitutes a section of the   CellProfiler manual) is populated by the documentation string of the   module's code, and contains the following: </p>
<ol>
  <li> <strong>The module's name:</strong> This is printed as a title automatically and is not specified within   the code for the module.</li>
  <li> <strong>'''&lt;b&gt; Module name &lt;/b&gt; phrase description</strong>.<br />
      <em>Example:</em> <strong>Identify Prim Automatic</strong> identifies objects via thresholding and contouring.<br />
    The section begins with threee single quotes. While the module's official name has no spaces, in this case use spaces and   sentence case to make it comprehensible. The phrase description is   something like:  &quot;identifies primary objects...&quot;  or &quot;places outlines   of objects...&quot;</li>
  <li><strong>&lt;hr&gt;</strong>: Creates a horizontal line</li>
  <li><strong>Full description/explanation of the module's function.</strong> Use headings, usually level &lt;h2&gt;, when needed</li>
  <li><strong>Features that can be measured by this module</strong>: Provide as an unordered list, like this<br />
      <pre>&lt;ul&gt;<br />
    &lt;li&gt;&lt;i&gt;First measurement:&lt;/i&gt; Description of first measurement&lt;/li&gt; <br />
    &lt;li&gt;&lt;i&gt;Second measurement:&lt;/i&gt; Descrption of second measurement &lt;/li&gt; <br />
&lt;/ul&gt;</pre>
    This creates a bulleted list of measurements that the module can make.   We say &quot;can&quot; because depending on the user's settings, not all   measurements will be made by a module during a run. We will eventually   make modules self-aware so that the list of possible measurements that   can be made will be generated by the code of the module itself.</li>
  <li><strong>See also: &lt;b&gt;OtherModuleName&lt;/b&gt;: </strong>Other relevant/related modules are listed here</li>
  <li> <strong>''' (end quotes): </strong>The general module help section ends with three single quotes</li>
  <li>License information follows and is commented out using #</li>
  <li>The help for the settings is obtained from the code itself (see below) and hence, does not need to be written out here</li>
</ol>
<h3><a name="python-style_guide-settings_help"></a>Settings Help</h3>
<p>In general, settings descriptions (which are displayed to the user in   the GUI) should be as concise as possible. For example,  <em>Enter the threshold scaling   factor</em> becomes <em>Threshold scaling factor</em>.</p>
<p>Some common standardized settings descriptions: </p>
<ul>
  <li><em>Select the input image</em></li>
  <li><em>Name the output image</em></li>
  <li><em>Name the identified objects</em></li>
</ul>
In these cases, copy the existing wordy description (e.g., <em>What do you want    to call...?</em>) to the first part of the help for that setting.
<p>The text for each setting's help is grabbed from the module's code, where   it looks like this: <br />
</p>
<pre>def create_settings(...):       <br />
    self.foo = cps.Bar(&quot;Quox&quot;, True, doc = '''
          Setting help is here bla bla,
          bla bla bla 
          bla bla''') </pre>
Note that the text for the setting is indented to line up at least after the period within <em>self.foo</em>.
<p>General stylistic notes</p>
<ul>
  <li> Other module names that are mentioned in the help should be <strong>&lt;b&gt; bold   &lt;/b&gt;</strong>. We will add hyperlinking function to go the other module's help   eventually.</li>
  <li>References that are mentioned should be <em>&lt;i&gt; italicized &lt;/i&gt;</em></li>
</ul>

<h2><a name="python-module_simplification"></a>Module Simplification</h2>
<p> See <em>imagemath.py</em> for an example. 
<ul>
<li>The order of the methods in each module should be: 
<blockquote><pre>
create_settings
settings
visible_settings
prepare_to_set_values
run
backwards_compatibilize</pre></blockquote>
<p>This list isn't exhaustive. <em>backwards_compatibilize</em> should definitely be last. Use judgment with others. Helper methods should be near the method they help. (see <em>imagemath</em>'s add_image). Th most useful thing is to add a comment wherever something isn't obvious from the code.  In the <em>run()</em> methods, in particular, block
comments (see imagemath.py) are useful for keeping other users oriented.</li>
<li><em>module_name</em> should be a class variable (not set in create_settings) </li>
<li>Settings
<ul>
	<li>Dynamic groups of settings should use cps.SettingsGroup (see imagemath.py for how to do this)</li>
	<li>Use cps.Divider to insert spaces between settings</li>
    <li>If code is going to use a setting's value more than once or twice, extract it to a local variable to avoid having to type self.setting.value too many times. (see the opval local variable in imagemath's <em>run()</em> method)</li>
    </ul></li></ul> </p>
    
<h2><a name="python-storing_retrieving_data"></a>Storing and Retrieving data</h2>
<h3><a name="python-cpimage"></a><em>cpimage</em></h3>
<h3><a name="python-cpmodule"></a><em>cpmodule</em></h3>
<h3><a name="python-settings"></a><em>settings</em></h3>
<h3><a name="python-preferences"></a><em>preferences</em></h3>
<h3><a name="python-pipeline"></a><em>pipeline</em></h3>
<h3><a name="python-workspace"></a><em>workspace</em></h3>
<h3><a name="python-measurements"></a><em>measurements</em></h3>

<h2><a name="python-error_handling"></a>Error Handling</h2>
<h2><a name="python-displaying_results"></a>Displaying Results</h2>
<h2><a name="python-debugging_hints"></a>Debugging Hints</h2>

<h1><a name="python-running_cp_headless"></a>Running CellProfiler without the graphical user interface</h1>
</div>
</body>

</html>
